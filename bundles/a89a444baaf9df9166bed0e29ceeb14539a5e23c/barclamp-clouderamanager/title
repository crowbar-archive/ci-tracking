THP Compaction changes merged into 2.3 from the Pebbles branch. 
